# Production profile – secure defaults

# DataSource (must be provided via env or secrets manager)
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USER}
spring.datasource.password=${DB_PASSWORD}

# JPA – do not auto-mutate schema in prod
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
spring.jpa.open-in-view=false

# Logging – minimize sensitive output
logging.level.root=INFO
logging.level.org.hibernate.SQL=ERROR
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=ERROR

# Supabase (provided via env)
supabase.url=${SUPABASE_URL}
supabase.key=${SUPABASE_KEY}
supabase.bucket.name=${SUPABASE_BUCKET:vehicle-images}
supabase.profile.bucket.name=${SUPABASE_PROFILE_BUCKET:profile-photos}

# Server
server.port=${PORT:8080}
server.forward-headers-strategy=framework
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=20s

# CORS (prod) – set your domain(s) only
app.cors.allowed-origins=https://herapherigoods.in,https://www.herapherigoods.in
app.frontendBaseUrl=https://www.herapherigoods.in

# CAPTCHA (enable in prod)
captcha.enabled=true
captcha.secret=${CAPTCHA_SECRET}

razorpay.key.id=${RAZORPAY_KEY_ID}
razorpay.key.secret=${RAZORPAY_KEY_SECRET}

# 2Factor template enforcement in prod
twofactor.template.login=${TWOFACTOR_TEMPLATE_LOGIN:userloginotp}
twofactor.template.signup=${TWOFACTOR_TEMPLATE_SIGNUP:usersignup}
twofactor.autogen.template-only=${TWOFACTOR_AUTOGEN_TEMPLATE_ONLY:true}

spring.flyway.baseline-on-migrate=true
spring.flyway.baseline-version=1
spring.flyway.locations=classpath:db/migration
spring.flyway.clean-disabled=true

# HikariCP – keep pool tiny for PgBouncer & prevent hitting max connections
spring.datasource.hikari.pool-name=HeraHikariPool
spring.datasource.hikari.maximum-pool-size=${DB_POOL_MAX:5}
spring.datasource.hikari.minimum-idle=${DB_POOL_MIN:0}
spring.datasource.hikari.idle-timeout=60000
spring.datasource.hikari.max-lifetime=300000
spring.datasource.hikari.connection-timeout=30000
# Important for PgBouncer transaction pooling (avoid server-side prepared statements)
spring.datasource.hikari.data-source-properties.prepareThreshold=0